"use client";

import { useQuery } from "@tanstack/react-query";
import Divider from "components/Divider";
import { EnvironmentalFootprintTypes } from "enums/environmentalFootprint.enum";
import Link from "next/link";
import React, { useEffect, useRef, useState } from "react";
import { getEnvironmentalFootprint } from "../action";

const EnvironmentalFootprint: React.FC<EnvironmentalFootprintProps> = (
  props,
) => {
  const { dataType, token, id, showOnlyBody } = props;

  const ref = useRef<HTMLDivElement>(null);
  const [width, setWidth] = useState(0);

  useEffect(() => {
    if (ref.current) {
      setWidth(ref.current.offsetWidth);
    }
  }, []);

  const { data, isLoading } = useQuery({
    queryFn: () => getEnvironmentalFootprint(token, dataType, id),
    queryKey: ["environmental-footprints", dataType, id],
  });

  const newData: EnvironmentalFootprintData[] = [
    {
      title: "Carbon emission saved",
      value: data?.co2e_footprint_kg || 0,
      icon: CarbonEmissionIcon,
      suffix: "kg CO2",
    },
    {
      title: "Energy saved",
      value: data?.cumulative_energy_demand_mj || 0,
      icon: EnergyIcon,
      suffix: "MJ",
    },
    {
      title: "Water saved",
      value: data?.eutrophication_footprint_m3 || 0,
      icon: WaterSavedIcon,
      suffix: "m3",
    },
    {
      title: "Freshwater nutrient pollution saved",
      value: data?.water_scarcity_footprint_g_peq || 0,
      icon: FreshWaterIcon,
      suffix: "kg P - Eq",
    },
  ];

  return (
    <div className="bg-beige w-full rounded-sm" ref={ref}>
      {!showOnlyBody && (
        <>
          <h6 className="p-4 font-semibold">Environmental Footprint </h6>
          <Divider />
        </>
      )}
      <div
        style={{
          gridTemplateColumns:
            width < 500 ? "1fr" : width < 900 ? "1fr 1fr" : "1fr 1fr 1fr 1fr",
        }}
        className="grid grid-cols-1 gap-4 p-4 sm:grid-cols-2 xl:grid-cols-4"
      >
        {newData?.map((item, index) => (
          <div className="flex w-full grow items-start gap-x-3" key={index}>
            <item.icon />
            <div className="flex flex-col items-start gap-y-1">
              {isLoading ? (
                <div className="shimmer-loading h-6 w-full rounded-md" />
              ) : (
                <h5 className="text-sm font-medium md:text-base">
                  {" "}
                  {item?.value?.toFixed(2)} {item?.suffix || ""}
                </h5>
              )}
              <h6 className="text-left text-xs text-neutral-400 md:text-sm">
                {" "}
                {item?.title}{" "}
              </h6>
            </div>
          </div>
        ))}
      </div>
      <div className="p-4 pt-0">
        <h6 className="col-span-2 mt-1 text-gray-500">
          *Environmental impact data is calculated using DKC’s ReLuxe Impact™
          method.{" "}
          <Link
            href={"/sustainability-commitment"}
            className="text-blue-500 underline"
          >
            Learn more
          </Link>
        </h6>
      </div>
    </div>
  );
};

export default EnvironmentalFootprint;

interface EnvironmentalFootprintProps {
  token: string;
  dataType: EnvironmentalFootprintTypes;
  id?: string;
  showOnlyBody?: boolean;
  maxTwoGrid?: boolean;
}

export const CarbonEmissionIcon = () => (
  <svg
    width="26"
    height="25"
    viewBox="0 0 26 25"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M11.2093 0.527063C9.97555 0.682007 8.49045 1.13773 7.37091 1.70738C3.78838 3.5257 1.38022 6.75676 0.694791 10.6668C0.548565 11.5008 0.49373 13.0776 0.580552 13.948C0.831877 16.4226 1.83718 18.7741 3.44566 20.6653C5.44713 23.0169 8.28025 24.5572 11.3007 24.9263C11.9953 25.0129 13.5078 25.0266 14.1567 24.9491C16.2541 24.7121 18.0911 24.0331 19.8458 22.8528C20.6774 22.2923 21.7696 21.2851 22.4413 20.4603C23.6522 18.9655 24.5524 17.056 24.9363 15.1739C25.1282 14.2123 25.1876 13.506 25.1556 12.3348C25.1282 11.2274 25.0414 10.6076 24.7809 9.60045C24.1549 7.21704 22.7977 5.03869 20.9471 3.45279C19.0918 1.86232 17.0035 0.900753 14.6137 0.540733C14.376 0.508833 14.1338 0.476933 14.0744 0.476933H13.9739L13.9831 1.46585L13.9968 2.45932L14.5451 2.55502C15.6418 2.75098 16.4506 3.01074 17.3782 3.4619C20.4672 4.97034 22.5921 7.88695 23.0902 11.3003C23.1907 11.9611 23.1998 13.3328 23.1176 13.9663C22.8069 16.3087 21.7924 18.3776 20.1474 20.0137C18.5846 21.5768 16.5968 22.5748 14.3623 22.9303C13.6632 23.0396 12.0456 23.0396 11.3464 22.9303C8.10661 22.4153 5.40143 20.5377 3.79295 17.6804C2.28956 15.0099 2.11135 11.5783 3.32228 8.74826C4.76169 5.39416 7.73647 3.0791 11.3373 2.52312L11.6891 2.46843V1.47496C11.6891 0.554405 11.6846 0.476933 11.6115 0.481489C11.5658 0.486048 11.3875 0.504276 11.2093 0.527063Z"
      fill="#333333"
    />
    <path
      d="M11.7335 11.4819H13.9726V8.54297H11.7335V11.4819Z"
      fill="#333333"
    />
    <path
      d="M8.67188 13.7838L10.157 13.7929L11.6421 13.8065L11.6558 15.356L11.6649 16.9054H14.0411L14.0548 15.3423L14.0639 13.7838H17.0342V11.4596H8.67188V13.7838Z"
      fill="#333333"
    />
  </svg>
);

export const EnergyIcon = () => (
  <svg
    width="27"
    height="26"
    viewBox="0 0 27 26"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M23.4881 0.568634C21.2961 0.826097 19.1641 1.58642 17.4081 2.74098C15.3281 4.10875 14.1321 5.71789 13.1441 8.48562C12.9121 9.14536 12.5641 10.3321 12.4041 11.0361C12.3401 11.3097 12.2801 11.5309 12.2681 11.5309C12.2561 11.5309 12.1401 11.3217 12.0121 11.0643C11.0281 9.1333 9.40814 7.59657 7.39214 6.67935C6.95214 6.48223 5.89614 6.10409 5.60414 6.04374L5.48014 6.01558L5.43214 6.36959C5.34414 7.0736 5.30814 7.54025 5.30014 8.10345L5.28814 8.68274L5.66814 8.81951C7.34814 9.42294 8.64414 10.4729 9.49214 11.9211C10.2081 13.1401 10.6081 14.6366 10.6921 16.4147L10.7201 17.0141L10.5281 16.9859C10.1921 16.9336 9.18414 16.6399 8.63214 16.4348C7.14014 15.8716 6.08014 15.2078 5.12814 14.2504C3.95614 13.0636 3.26414 11.6878 2.94014 9.90166C2.86014 9.43501 2.84814 9.26605 2.85214 8.33275C2.85614 7.36726 2.91614 6.50235 3.02414 5.82651C3.04014 5.70582 3.04014 5.60525 3.02014 5.59318C2.97614 5.56502 0.596138 5.47652 0.568138 5.50468C0.548138 5.52077 0.344138 6.57074 0.288138 6.92475C0.228138 7.33106 0.200138 8.38102 0.232138 8.99652C0.328138 10.7263 0.748138 12.2832 1.49214 13.6992C2.45614 15.5296 4.05614 17.0945 6.04814 18.1525C7.03214 18.6755 8.44814 19.1945 9.64814 19.4761C10.5521 19.6853 10.6121 19.7094 10.7521 19.9306C11.1241 20.522 11.2521 21.4754 11.2961 24.0299L11.3201 25.4902H12.6121H13.9041L13.9001 23.0443C13.8921 20.5381 13.9241 19.5927 14.0721 17.6778C14.1401 16.7606 14.2601 15.5658 14.3321 15.0871L14.3561 14.9182L14.6401 14.89C15.0801 14.8498 15.9401 14.6848 16.6521 14.5078C21.9961 13.1763 25.3481 9.38271 26.0481 3.86738C26.1441 3.10706 26.1881 2.33065 26.1881 1.38125V0.508291L25.0601 0.512314C24.4281 0.516336 23.7321 0.540474 23.4881 0.568634ZM23.6041 3.27199C23.3681 5.29951 22.6321 7.13394 21.4681 8.61435C20.2961 10.1068 18.4561 11.2735 16.3281 11.8809C15.8801 12.0056 14.8601 12.2188 14.8321 12.1907C14.7681 12.1303 15.3161 10.1028 15.6241 9.27007C16.3481 7.29887 17.0241 6.3173 18.4401 5.18285C19.7641 4.12484 21.5121 3.36854 23.1281 3.15131C23.3721 3.11913 23.5801 3.09097 23.5961 3.08694C23.6121 3.08292 23.6161 3.1674 23.6041 3.27199Z"
      fill="#333333"
    />
  </svg>
);

export const WaterSavedIcon = () => (
  <svg
    width="21"
    height="29"
    viewBox="0 0 21 29"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M11.2734 0.646601C11.2869 0.975615 11.3048 1.76435 11.3227 2.39533L11.3541 3.54914L11.7574 4.0404C14.1684 6.99252 16.0999 9.91759 17.2651 12.3965C18.7753 15.601 19.0622 17.8545 18.2734 20.3108C17.8522 21.6179 16.8349 23.1097 15.7773 23.9796C14.1864 25.2866 12.4431 25.9221 10.4668 25.9221C7.06535 25.9176 4.05383 23.8353 2.81695 20.6398C2.22988 19.13 2.10888 17.6201 2.43603 15.9796C2.97828 13.2708 4.83808 9.76435 7.8496 5.75759L8.32015 5.13561L8.29775 4.40547C8.2843 4.00885 8.26189 3.26519 8.24845 2.7559L8.21708 1.83195L7.84512 2.27815C6.35728 4.08097 4.53334 6.64547 3.43539 8.47984C1.73244 11.3328 0.728603 13.7441 0.298385 16.0291C0.208757 16.5024 0.195312 16.7187 0.195312 17.7193C0.195312 18.6387 0.213238 18.9587 0.275978 19.3193C0.482124 20.4505 0.75101 21.2843 1.22604 22.2489C2.04166 23.9165 3.26509 25.3182 4.79326 26.3367C6.65754 27.5852 8.62041 28.1441 10.8611 28.072C12.6178 28.0179 14.1595 27.5807 15.6563 26.7108C18.4303 25.1018 20.2945 22.3435 20.7696 19.139C20.8771 18.4043 20.8771 17.0793 20.7696 16.3672C20.5186 14.7041 19.8912 12.8517 18.9187 10.8911C17.5788 8.20491 15.6114 5.2528 13.1198 2.19252C12.4296 1.34519 11.3451 0.0832214 11.2913 0.0606861C11.2734 0.056179 11.2645 0.317587 11.2734 0.646601Z"
      fill="#333333"
    />
  </svg>
);

export const FreshWaterIcon = () => (
  <svg
    width="22"
    height="35"
    viewBox="0 0 22 35"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M11.9765 6.6466C11.99 6.97561 12.0079 7.76435 12.0258 8.39533L12.0572 9.54914L12.4605 10.0404C14.8715 12.9925 16.803 15.9176 17.9682 18.3965C19.4785 21.601 19.7653 23.8545 18.9765 26.3108C18.5553 27.6179 17.538 29.1097 16.4804 29.9796C14.8895 31.2866 13.1462 31.9221 11.1699 31.9221C7.76848 31.9176 4.75695 29.8353 3.52008 26.6398C2.93301 25.13 2.81201 23.6201 3.13915 21.9796C3.68141 19.2708 5.5412 15.7643 8.55273 11.7576L9.02328 11.1356L9.00087 10.4055C8.98743 10.0089 8.96502 9.26519 8.95158 8.7559L8.92021 7.83195L8.54825 8.27815C7.06041 10.081 5.23647 12.6455 4.13851 14.4798C2.43557 17.3328 1.43173 19.7441 1.00151 22.0291C0.911882 22.5024 0.898438 22.7187 0.898438 23.7193C0.898438 24.6387 0.916363 24.9587 0.979103 25.3193C1.18525 26.4505 1.45414 27.2843 1.92917 28.2489C2.74479 29.9165 3.96822 31.3182 5.49639 32.3367C7.36067 33.5852 9.32353 34.1441 11.5643 34.072C13.321 34.0179 14.8626 33.5807 16.3594 32.7108C19.1334 31.1018 20.9977 28.3435 21.4727 25.139C21.5803 24.4043 21.5803 23.0793 21.4727 22.3672C21.2217 20.7041 20.5943 18.8517 19.6219 16.8911C18.2819 14.2049 16.3146 11.2528 13.8229 8.19252C13.1328 7.34519 12.0482 6.08322 11.9945 6.06069C11.9765 6.05618 11.9676 6.31759 11.9765 6.6466Z"
      fill="#333333"
    />
    <path
      d="M9.50026 23.5437C9.51689 23.4882 9.52242 23.43 9.51655 23.3723C9.51067 23.3147 9.4935 23.2588 9.46602 23.2078C9.43854 23.1568 9.40129 23.1118 9.35639 23.0752C9.31149 23.0386 9.25982 23.0112 9.20434 22.9946C9.14885 22.9779 9.09064 22.9724 9.03301 22.9783C8.97539 22.9842 8.91949 23.0013 8.8685 23.0288C8.81751 23.0563 8.77243 23.0935 8.73584 23.1384C8.69925 23.1833 8.67186 23.235 8.65524 23.2905L9.50026 23.5437ZM13.3426 23.6334L12.9159 23.7458L12.9173 23.7484L13.3426 23.6334ZM8.73052 21.1763C8.74286 21.2329 8.76621 21.2865 8.79926 21.3341C8.83231 21.3816 8.8744 21.4222 8.92313 21.4535C8.97186 21.4848 9.02627 21.5061 9.08326 21.5164C9.14026 21.5267 9.19871 21.5256 9.25529 21.5133C9.31187 21.5009 9.36546 21.4776 9.41302 21.4445C9.46057 21.4115 9.50115 21.3694 9.53243 21.3207C9.56372 21.2719 9.5851 21.2175 9.59535 21.1605C9.60561 21.1035 9.60454 21.0451 9.59221 20.9885L8.73052 21.1763ZM10.5541 16.492L12.0291 16.5666L12.122 16.0488L10.647 15.9741L10.5541 16.492ZM11.4097 26.7233L10.954 26.7005L10.9093 27.5812L11.3653 27.6046L11.4097 26.7233ZM12.9458 23.8538L13.1213 24.4907L13.9715 24.2564L13.7965 23.6205L12.9458 23.8538ZM9.27447 24.2667L9.46743 23.6493L8.62557 23.387L8.43313 24.0042L9.27447 24.2667ZM9.77619 17.9226L10.9787 16.1707L10.218 15.7943L9.05986 17.4078L9.77619 17.9226ZM11.6802 16.3646L12.7923 18.0933L13.5333 17.6165L12.4221 15.8881L11.6802 16.3646ZM11.017 16.0574L11.0242 15.5402L10.1424 15.5273L10.135 16.0454L11.017 16.0574ZM11.0549 15.5104L11.5899 15.5381L11.6345 14.6573L11.0998 14.6301L11.0549 15.5104ZM11.6178 15.5678L11.61 16.1201L12.4923 16.1326L12.4998 15.5798L11.6178 15.5678ZM12.7917 18.0935L12.8478 18.1809L13.5977 17.7168L13.5339 17.6176L12.7917 18.0935ZM13.9058 20.9147C13.9244 20.8647 13.9359 20.8352 13.9459 20.8065L13.1144 20.5114L13.0797 20.606L13.9058 20.9147ZM12.8478 18.1809C13.2882 18.8914 13.3829 19.7536 13.1144 20.5114L13.9459 20.8065C14.3063 19.7881 14.1746 18.6476 13.5977 17.7168L12.8478 18.1809ZM9.42572 20.3934L9.39327 20.2954L8.55266 20.56C8.56191 20.5898 8.57171 20.6205 8.58918 20.6719L9.42572 20.3934ZM9.05986 17.4078C9.02922 17.4502 9.01048 17.4763 8.9933 17.5015L9.71874 18.0034L9.77619 17.9226L9.05986 17.4078ZM9.39407 20.2957C9.14394 19.502 9.26818 18.6553 9.71874 18.0034L8.9933 17.5015C8.38218 18.3854 8.22351 19.5166 8.55266 20.56L9.39407 20.2957ZM9.46743 23.6493L9.49999 23.5431L8.65496 23.29L8.62557 23.387L9.46743 23.6493ZM8.58866 20.6721L8.62139 20.7706L9.46081 20.5014C9.45212 20.4727 9.4424 20.4445 9.4252 20.3937L8.58866 20.6721ZM13.7957 23.6203L13.7764 23.5506L13.7705 23.5271L13.7684 23.5208L13.7673 23.5188L13.3418 23.6332L12.9163 23.7476L12.9168 23.7487L12.9171 23.7505L12.9186 23.757L12.9251 23.7816L12.9455 23.8546L13.7957 23.6203ZM13.0797 20.606L13.0408 20.7102L13.8703 21.0091L13.9058 20.9147L13.0797 20.606ZM10.9535 26.7007C10.521 26.6788 10.2199 26.6633 9.98795 26.6348C9.75834 26.607 9.6387 26.5703 9.55782 26.5276L9.14661 27.3078C9.36604 27.4238 9.60923 27.477 9.88107 27.5102C10.1508 27.5432 10.4898 27.5598 10.9093 27.5812L10.9535 26.7007ZM8.43313 24.0042C8.30706 24.4078 8.20461 24.7333 8.14204 24.9989C8.07846 25.2663 8.04433 25.514 8.07589 25.7598L8.95021 25.6479C8.93818 25.5556 8.94621 25.4286 9.00013 25.2017C9.05373 24.973 9.14507 24.6827 9.27447 24.2667L8.43313 24.0042ZM9.55782 26.5276C9.3938 26.4398 9.25338 26.3146 9.14766 26.1615C9.04194 26.0085 8.97425 25.8324 8.95021 25.6479L8.07538 25.7601C8.11751 26.0847 8.23671 26.3945 8.42302 26.6637C8.60933 26.9329 8.85761 27.1541 9.14661 27.3078L9.55782 26.5276ZM11.3645 27.6043C11.7844 27.6263 12.1223 27.6435 12.3933 27.6378C12.6651 27.6323 12.9131 27.6036 13.1406 27.5078L12.7989 26.6951C12.7228 26.7272 12.6059 26.7518 12.3748 26.7561C12.1437 26.7604 11.8424 26.7457 11.4091 26.7236L11.3645 27.6043ZM13.1205 24.4905C13.2384 24.9188 13.3204 25.219 13.3688 25.4539C13.4161 25.6879 13.4207 25.8162 13.4064 25.9052L14.2771 26.0432C14.3158 25.7991 14.2884 25.5498 14.2327 25.2775C14.1773 25.0071 14.0856 24.6727 13.9715 24.2564L13.1205 24.4905ZM13.1406 27.5078C13.4394 27.3812 13.7008 27.18 13.8997 26.9236C14.0987 26.6672 14.2286 26.3641 14.2771 26.0432L13.4058 25.9055C13.3809 26.078 13.312 26.2412 13.2058 26.3794C13.0996 26.5176 12.9597 26.6263 12.7995 26.6949L13.1406 27.5078ZM11.5899 15.5381L11.6881 15.5435C11.7136 15.5454 11.7312 15.5471 11.7409 15.5486C11.7615 15.5509 11.7338 15.5504 11.6953 15.5283L12.1263 14.7588C12.0423 14.714 11.9507 14.6852 11.8562 14.674C11.787 14.6644 11.707 14.6605 11.6345 14.6573L11.5899 15.5381ZM12.4993 15.5801C12.5004 15.5075 12.5016 15.4275 12.497 15.3579C12.4923 15.2831 12.4785 15.1851 12.4299 15.0831L11.6341 15.4637C11.6151 15.4232 11.6159 15.3961 11.6175 15.4166L11.6185 15.4694L11.6178 15.5678L12.4993 15.5801ZM11.6953 15.5283C11.6689 15.5135 11.6472 15.4911 11.6341 15.4637L12.4299 15.0831C12.3646 14.9463 12.2585 14.833 12.1263 14.7588L11.6953 15.5283ZM11.0234 15.5399L11.0257 15.4346C11.0262 15.4057 11.0276 15.3883 11.0283 15.3772C11.0306 15.354 11.0314 15.3829 11.0086 15.4251L10.2331 15.0054C10.1761 15.1106 10.1582 15.2142 10.1506 15.2922C10.1434 15.3648 10.1429 15.4497 10.1419 15.5276L11.0234 15.5399ZM11.0998 14.6301C11.0224 14.6262 10.9365 14.6215 10.8632 14.6241C10.7628 14.6258 10.6638 14.6474 10.5717 14.6874L10.9407 15.4888C10.8978 15.5084 10.8686 15.5061 10.8917 15.5057C10.9019 15.5047 10.9209 15.505 10.9488 15.5065C10.9778 15.507 11.011 15.5092 11.0547 15.5112L11.0998 14.6301ZM11.0086 15.4251C10.9933 15.453 10.9697 15.4757 10.9407 15.4888L10.5717 14.6874C10.4274 14.754 10.3086 14.8656 10.2331 15.0054L11.0086 15.4251ZM9.59248 20.989C9.55671 20.825 9.51272 20.6623 9.46054 20.5008L8.62139 20.7706C8.66459 20.9042 8.70118 21.0391 8.73052 21.1763L9.59248 20.989ZM13.7684 23.5208C13.6655 23.1292 13.6183 22.7297 13.6268 22.3344L12.7444 22.3166C12.7346 22.7985 12.7926 23.2799 12.9159 23.7458L13.7684 23.5208ZM13.6268 22.3344C13.6346 21.8822 13.7168 21.4345 13.8703 21.0091L13.0408 20.7102C12.8555 21.2259 12.7553 21.7682 12.7441 22.3161L13.6268 22.3344Z"
      fill="#333333"
    />
    <path
      d="M13.0487 18.577L12.7074 18.9384C12.3369 19.3301 11.7924 19.5076 11.2623 19.4092C10.9636 19.3536 10.6553 19.3848 10.3738 19.4991C10.0924 19.6135 9.84967 19.8062 9.67451 20.0544L9.39892 20.444"
      stroke="#333333"
      stroke-width="0.481011"
      stroke-linecap="square"
    />
    <path
      d="M9.77241 3.90007L12.2428 3.91057V0.640625H9.77241V3.90007Z"
      fill="#333333"
    />
    <path
      d="M6.39453 6.47161L8.03306 6.48175L9.67158 6.49696L9.6867 8.22091V9.85656H12.3336V8.2057L12.3436 6.47161L12.2428 3.91057L6.39453 3.8857V6.47161Z"
      fill="#333333"
    />
  </svg>
);

export interface EnvironmentalFootprintData {
  title: string;
  value: number;
  icon: () => JSX.Element;
  suffix: string;
}
